# app.py
# ุชุทุจูู ุฃุฐูุงุฑ ุฅุณูุงููุฉ ูุงูู โ Streamlit
# ูุชุทูุจุงุช: streamlit
# ุชุดุบูู: pip install streamlit
#         streamlit run app.py

import streamlit as st
import json
from io import BytesIO
from datetime import datetime

# ---------------------------
# ุจูุงูุงุช ุงูุฃุฐูุงุฑ (ูุต ุนุฑุจูุ ูุตุฏุฑ ุนุงูุ ููุงุฆุฏุฉ ูุตูุฑุฉ)
# ููุงุญุธุฉ: ุงููุตุงุฏุฑ ุฐูุฑุช ุจุตูุฉ "ุงููุฑุขู" ุฃู "ุงูุณูุฉ/ุญุตู ุงููุณูู" ุจุดูู ุนุงู.
# ุฅู ุฃุฑุฏุช ูุฑุงุฌุน ุฏูููุฉ (ุงุณู ุงููุชุงุจ/ุงูุฑุงูู/ุฑูู ุงูุญุฏูุซ/ุณูุฑุฉ:ุขูุฉ) ุฃุถูููุง ูุงุญูุงู.
# ---------------------------

ZIKR_DATA = {
    "ูุถู ุงูุฃุฐูุงุฑ": [
        {
            "title": "ูุถู ุงูุฐูุฑ ูุทูุฃูููุฉ ุงูููุจ",
            "text": "ุฃูุง ุจุฐูุฑ ุงููู ุชุทูุฆู ุงููููุจ.",
            "source": "ุงููุฑุขู ุงููุฑูู โ ุงูุณูุฑุฉ: ุงูุฑุนุฏ (13:28)",
            "benefit": "ุทูุฃูููุฉ ุงูููุจ ูุงูุณูููุฉ ุจูุฑุจ ุงููู."
        },
        {
            "title": "ูุซู ุงูุฐุงูุฑ ูุงูุบูุฑ ุฐุงููุฑ",
            "text": "ูุซู ุงูุฐู ูุฐูุฑ ุฑุจู ูุงูุฐู ูุง ูุฐูุฑ ุฑุจู ูุซู ุงูุญู ูุงูููุช.",
            "source": "ุงูุณูุฉ ุงููุจููุฉ (ูุฃุซูุฑ)",
            "benefit": "ุจูุงู ูุถู ุงูุฐูุฑ ูุฃูู ุญูุงุฉ ุงูููุจ."
        },
        {
            "title": "ุงูุฐูุฑ ุนูุงุฏ ุงูุนุจุงุฏุฉ",
            "text": "ุงูุฐูุฑ ุณุจุจ ูุฑุจุญ ุงูุฏููุง ูุงูุขุฎุฑุฉ ูุฐุฎุฑ ูููุคูู.",
            "source": "ุงูุณูุฉ ุงููุจููุฉ / ุงูุฃุฐูุงุฑ ุงููุฃุซูุฑุฉ",
            "benefit": "ุชูููุฉ ุงูุนูุงูุฉ ูุน ุงููู ูุฒูุงุฏุฉ ุงูุฃุฌุฑ."
        }
    ],
    "ุฃุฐูุงุฑ ุงูุตุจุงุญ": [
        {
            "title": "ุจุณู ุงููู ุงูุฐู ูุง ูุถุฑ ูุน ุงุณูู ุดูุก",
            "text": "ุจูุณููู ุงูููููู ุงูููุฐูู ูุง ููุถูุฑูู ููุนู ุงุณููููู ุดูููุกู ููู ุงูุฃูุฑูุถู ูููุง ููู ุงูุณููููุงุกู ูููููู ุงูุณูููููุนู ุงููุนูููููู",
            "source": "ุงูุณูุฉ ุงููุจููุฉ (ุญุตู ุงููุณูู)",
            "benefit": "ุญูุธ ูู ุงูููุฑูู ุฎูุงู ุงูููู."
        },
        {
            "title": "ุฃุตุจุญูุง ูุฃูุณู",
            "text": "ุฃูุตูุจูุญูููุง ูุฃูููุณูููููุง ููุจูููุนูููุฉู ุงูููููู...",
            "source": "ุฃุฐูุงุฑ ุงูุตุจุงุญ ุงููุฃุซูุฑุฉ (ุญุตู ุงููุณูู)",
            "benefit": "ุดูุฑ ุนูู ุงููุนูุฉ ูุงุณุชุนุงูุฉ ุจุงููู ุทูุงู ุงูููู."
        },
        {
            "title": "ุขูุฉ ุงููุฑุณู",
            "text": "ุงูููููู ููุง ุฅููููู ุฅููููุง ูููู ุงููุญูููู ุงูููููููููู ...",
            "source": "ุงููุฑุขู ุงููุฑูู โ ุณูุฑุฉ ุงูุจูุฑุฉ (2:255)",
            "benefit": "ุญูุงูุฉ ููุถู ุนุธูู ุนูุฏ ุงูุตุจุงุญ ูุงููุณุงุก."
        },
        {
            "title": "ุณูุฑุฉ ุงูุฅุฎูุงุต ูุงููุนูุฐุงุช",
            "text": "ูููู ูููู ุงูููููู ุฃูุญูุฏู ... ูููู ุฃูุนููุฐู ุจูุฑูุจูู ุงูููููููู ... ูููู ุฃูุนููุฐู ุจูุฑูุจูู ุงููููุงุณู",
            "source": "ุงููุฑุขู ุงููุฑูู",
            "benefit": "ุญูุธ ูุญูุงูุฉ ูู ุงูุดุฑูุฑ."
        },
        {
            "title": "ุฏุนุงุก ุงูุญูุธ",
            "text": "ุงููููููููู ุฅููููู ุฃูุตูุจูุญูุชู ุฃูุดูููุฏููู ...",
            "source": "ุฃุฐูุงุฑ ุงูุตุจุงุญ ุงููุชุนุงุฑู ุนูููุง",
            "benefit": "ุทูุจ ุงูุญูุงูุฉ ูุงูุจุฑูุฉ ูู ุงูููู."
        }
    ],
    "ุฃุฐูุงุฑ ุงููุณุงุก": [
        {
            "title": "ุฃูุณููุง ูุฃูุณู ุงูููู ููู",
            "text": "ุฃูููุณูููููุง ููุฃูููุณูู ุงูููููููู ููููููู ...",
            "source": "ุฃุฐูุงุฑ ุงููุณุงุก ุงููุฃุซูุฑุฉ",
            "benefit": "ุดูุฑ ูุญูุธ ูู ุงููุณุงุก."
        },
        {
            "title": "ุขูุฉ ุงููุฑุณู",
            "text": "ุงูููููู ููุง ุฅููููู ุฅููููุง ูููู ...",
            "source": "ุงููุฑุขู ุงููุฑูู โ ุณูุฑุฉ ุงูุจูุฑุฉ",
            "benefit": "ุญูุงูุฉ ูุฑุงุญุฉ ูู ุงููุณุงุก."
        },
        {
            "title": "ุณูุฑุฉ ุงูุฅุฎูุงุต ูุงููุนูุฐุงุช",
            "text": "ูููู ูููู ุงูููููู ุฃูุญูุฏู ...",
            "source": "ุงููุฑุขู ุงููุฑูู",
            "benefit": "ููุงูุฉ ูู ุงูุดุฑูุฑ ูุจู ุงูููู."
        },
        {
            "title": "ุงูุญูุฏ ููู ุงูุฐู ุฃุทุนููุง ูุณูุงูุง",
            "text": "ุงููุญูููุฏู ููููููู ุงูููุฐูู ุฃูุทูุนูููููุง ...",
            "source": "ุฃุฐูุงุฑ ุงููุณุงุก ุงููุชุนุงุฑู ุนูููุง",
            "benefit": "ุดูุฑ ุนูู ุงููุนู ูุงูุงุณุชุนุฏุงุฏ ููุงุณุชุฑุฎุงุก."
        }
    ],
    "ุฃุฐูุงุฑ ุงูููู": [
        {
            "title": "ุงูููู ุจุงุณูู ุฃููุช ูุฃุญูุง",
            "text": "ุงููููููููู ุจูุงุณููููู ุฃููููุชู ูุฃูุญูููุง",
            "source": "ุฃุฐูุงุฑ ุงูููู ุงููุฃุซูุฑุฉ",
            "benefit": "ุชููู ุนูู ุงููู ุนูุฏ ุงูููู."
        },
        {
            "title": "ุขูุฉ ุงููุฑุณู ูุจู ุงูููู",
            "text": "ุงูููููู ููุง ุฅููููู ุฅููููุง ูููู ...",
            "source": "ุงููุฑุขู ุงููุฑูู",
            "benefit": "ุญูุธ ูู ุงูุดูุทุงู ูุงูุญูุงูุฉ ุฃุซูุงุก ุงูููู."
        },
        {
            "title": "ุงูููู ููู ุนุฐุงุจู ููู ุชุจุนุซ ุนุจุงุฏู",
            "text": "ุงููููููููู ููููู ุนูุฐูุงุจููู ูููููู ุชูุจูุนูุซู ุนูุจูุงุฏููู",
            "source": "ุฃุฐูุงุฑ ุงูููู ุงููุฃุซูุฑุฉ",
            "benefit": "ุทูุจ ุฃูุงู ูู ุนุฐุงุจ ุงูุขุฎุฑุฉ."
        }
    ],
    "ุฃุฐูุงุฑ ุงูุฎุฑูุฌ ูู ุงูููุฒู": [
        {
            "title": "ุจุณู ุงููู ุชูููุช ุนูู ุงููู ููุง ุญูู ููุง ููุฉ ุฅูุง ุจุงููู",
            "text": "ุจูุณููู ุงููููููุ ุชููููููููุชู ุนูููู ุงููููููุ ููุง ุญููููู ููููุง ูููููุฉู ุฅููููุง ุจูุงูููููู",
            "source": "ุฃุฐูุงุฑ ูุฃุซูุฑุฉ ููุฎุฑูุฌ",
            "benefit": "ุงูุงุณุชุนุงูุฉ ุจุงููู ูุงูุซูุฉ ูู ูุฏุฑุชู."
        },
        {
            "title": "ุฏุนุงุก ุงูุงุณุชุนุงูุฉ ูุงูุญูุธ",
            "text": "ุงููููููููู ุฅููููู ุฃูุนููุฐู ุจููู ุฃููู ุฃูุถูููู ...",
            "source": "ุฃุฐูุงุฑ ูุฃุซูุฑุฉ",
            "benefit": "ุทูุจ ุงูุญูุธ ูุงููุฏุงูุฉ ุนูุฏ ุงูุฎุฑูุฌ."
        }
    ],
    "ุฃุฐูุงุฑ ุงูุฏุฎูู ุฅูู ุงูููุฒู": [
        {
            "title": "ุงูุณูุงู ุนูู ุฃูู ุงูุจูุช",
            "text": "ุงููููููููู ุจูุงุฑููู ููู ููููููู ุฏูุฎูููุชู ููุงุบูููุฑู ููู",
            "source": "ุฃุฐูุงุฑ ุงูุฏุฎูู ุงููุชุนุงุฑู ุนูููุง",
            "benefit": "ุทูุจ ุงูุจุฑูุฉ ูุงูุณูุงูุฉ ููููุฒู."
        },
        {
            "title": "ุงูููู ุฃุนูุง ุนูู ุดูุฑ ูุนูุชู",
            "text": "ุณูุจูุญูุงูู ุงูููููู ...",
            "source": "ุฃุฐูุงุฑ ูุฃุซูุฑุฉ",
            "benefit": "ุดูุฑ ุงููู ุนูู ุงูุนูุฏุฉ ููููุฒู."
        }
    ],
    "ุฃุฐูุงุฑ ุงููุถูุก": [
        {
            "title": "ุจุณู ุงููู ูุงูุญูุฏ ููู",
            "text": "ุจูุณููู ุงูููููู ... ุงููุญูููุฏู ููููููู",
            "source": "ุฃุฐูุงุฑ ุงููุถูุก ุงููุฃุซูุฑุฉ",
            "benefit": "ุงุณุชุญุถุงุฑ ุงูููุฉ ูุงูุทูุงุฑุฉ ุงูุฑูุญูุฉ."
        },
        {
            "title": "ุงูููู ุงุฌุนููู ูู ุงูุชูุงุจูู",
            "text": "ุงููููููููู ุงุฌูุนูููููู ูููู ุงูุชูููููุงุจูููู",
            "source": "ุฃุฐูุงุฑ ูุฃุซูุฑุฉ ุจุนุฏ ุงููุถูุก",
            "benefit": "ุทูุจ ุงูุซุจุงุช ูุงูุชูุจุฉ."
        }
    ],
    "ุฃุฐูุงุฑ ุงูุฃูู": [
        {
            "title": "ุจุณู ุงููู",
            "text": "ุจูุณููู ุงูููููู",
            "source": "ุงููุฑุขู ูุงูุณูุฉ",
            "benefit": "ุจุฑูุฉ ููุฃูู ูุชุฌูุจ ุงูุฅุณุฑุงู."
        },
        {
            "title": "ุงูุญูุฏ ููู ุงูุฐู ุฃุทุนููุง",
            "text": "ุงููุญูููุฏู ููููููู ุงูููุฐูู ุฃูุทูุนูููููุง ...",
            "source": "ุฃุฐูุงุฑ ุงูุทุนุงู ุงููุฃุซูุฑุฉ",
            "benefit": "ุดูุฑ ุงููู ุนูู ุงููุนูุฉ."
        },
        {
            "title": "ุงูุญูุฏ ููู ุงูุฐู ุฃุทุนููู ูุณูุงูู",
            "text": "ุงููุญูููุฏู ููููููู ุงูููุฐูู ุฃูุทูุนูููููุง ููุณูููุงููุง...",
            "source": "ุฃุฐูุงุฑ ูุฃุซูุฑุฉ",
            "benefit": "ุดูุฑ ูุฐูุฑ ุงููู ุจุนุฏ ุงูุฃูู."
        }
    ],
    "ุฃุฐูุงุฑ ุจุนุฏ ุงูุตูุงุฉ": [
        {
            "title": "ุณุจุญุงู ุงููู ูุงูุญูุฏ ููู",
            "text": "ุณูุจูุญูุงูู ุงูููููู ููุงููุญูููุฏู ููููููู",
            "source": "ุฃุฐูุงุฑ ูุง ุจุนุฏ ุงูุตูุงุฉ",
            "benefit": "ุชูุฌูุฏ ุงููู ูุดูุฑ ุงูุฃุนูุงู."
        },
        {
            "title": "ุฃุณุชุบูุฑ ุงููู",
            "text": "ุฃูุณูุชูุบูููุฑู ุงูููููู",
            "source": "ุฃุฐูุงุฑ ูุง ุจุนุฏ ุงูุตูุงุฉ",
            "benefit": "ุทูุจ ุงููุบูุฑุฉ ุจุนุฏ ุงูุตูุงุฉ."
        }
    ],
    "ุฃุฐูุงุฑ ุฏุฎูู ุงููุณุฌุฏ": [
        {
            "title": "ุงูููู ุงูุชุญ ูู ุฃุจูุงุจ ุฑุญูุชู",
            "text": "ุงููููููููู ุงููุชูุญู ููู ุฃูุจูููุงุจู ุฑูุญูููุชููู",
            "source": "ุฃุฐูุงุฑ ุฏุฎูู ุงููุณุฌุฏ",
            "benefit": "ุทูุจ ูุจูู ุงูุนุจุงุฏุฉ ูุงูุฎุดูุน."
        },
        {
            "title": "ุงูุณูุงู ุนูู ุฃูู ุงููุณุฌุฏ",
            "text": "ุงูุณูุงู ุนูู ุฃูู ุงูุฐูุฑ",
            "source": "ุฃุฐูุงุฑ ูุฃุซูุฑุฉ",
            "benefit": "ุขุฏุงุจ ุฏุฎูู ุงููุณุฌุฏ ูุชุญุจูุจ ุงููุตููู."
        }
    ],
    "ุฃุฐูุงุฑ ุงูุณูุฑ": [
        {
            "title": "ุงูููู ุฃูุช ุงูุตุงุญุจ ูู ุงูุณูุฑ",
            "text": "ุงููููููููู ุฃูููุชู ุงูุตููุงุญูุจู ููู ุงูุณููููุฑู ...",
            "source": "ุฃุฐูุงุฑ ุงูุณูุฑ ุงููุฃุซูุฑุฉ",
            "benefit": "ุทูุจ ุงูุณูุงูุฉ ูุงูุญูุธ ูู ุงูุณูุฑ."
        },
        {
            "title": "ุงูููู ุฅูู ุฃุนูุฐ ุจู ูู ูุนุซุงุก ุงูุณูุฑ",
            "text": "ุงููููููููู ุฅููููู ุฃูุนููุฐู ุจููู ูููู ููุนูุซูุงุกู ุงูุณููููุฑู ...",
            "source": "ุฃุฐูุงุฑ ุงูุณูุฑ",
            "benefit": "ุงูุญูุงูุฉ ูู ูุดุงู ุงูุณูุฑ."
        }
    ],
    "ุฃุฐูุงุฑ ุงููุฑุจ ูุงููู": [
        {
            "title": "ุงูููู ุฅูู ุนุจุฏู ุงุจู ุนุจุฏู",
            "text": "ุงููููููููู ุฅููููู ุนูุจูุฏููู ุงุจููู ุนูุจูุฏููู ...",
            "source": "ุฃุฐูุงุฑ ุงููุฑุจ ุงููุฃุซูุฑุฉ",
            "benefit": "ุงูุชูุฑูุบ ูุงูุฑุฌูุน ุฅูู ุงููู ูู ุงูุดุฏุงุฆุฏ."
        },
        {
            "title": "ูุง ุญู ูุง ูููู",
            "text": "ููุง ุญูููู ููุง ูููููููู ุจูุฑูุญูููุชููู ุฃูุณูุชูุบููุฐู",
            "source": "ุฐูุฑ ุงูุงุณุชุนุงุฐุฉ ูุงูุฑุฌุงุก ุจุงููู",
            "benefit": "ุทูุจ ุงููุตุฑ ูุงููุฑุฌ."
        }
    ]
}

# ---------------------------
# ุฏูุงู ูุณุงุนุฏุฉ ูููุงุฌูุฉ
# ---------------------------

def init_state():
    """ุชููุฆุฉ session_state ูููุชุบูุฑุงุช ุงูุถุฑูุฑูุฉ"""
    if "page" not in st.session_state:
        st.session_state.page = "welcome"  # welcome, home, section:<name>
    if "last_visit" not in st.session_state:
        st.session_state.last_visit = None
    if "font_size" not in st.session_state:
        st.session_state.font_size = 18
    if "theme" not in st.session_state:
        st.session_state.theme = "light"
    if "search" not in st.session_state:
        st.session_state.search = ""

def go_home():
    st.session_state.page = "home"

def open_section(name):
    st.session_state.page = f"section::{name}"

def download_section_json(section_name):
    """ุฅุฑุฌุงุน ููู JSON ุฌุงูุฒ ููุชุญููู ููุญุชูู ุงููุณู"""
    items = ZIKR_DATA.get(section_name, [])
    data = {"section": section_name, "items": items, "exported_at": datetime.now().isoformat()}
    return json.dumps(data, ensure_ascii=False, indent=2).encode("utf-8")


# ---------------------------
# ูุงุฌูุฉ CSS ูุงูุฎูููุฉ
# ---------------------------

PAGE_STYLE = """
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap');
html, body, [class*="css"]  {
    font-family: 'Cairo', sans-serif;
    color: #0b2b1d;
}

/* ุงูุฎูููุฉ ุงูุฅุณูุงููุฉ ุงูุฎูููุฉ */
[data-testid="stAppViewContainer"] {
    background-image: url('https://images.unsplash.com/photo-1512453979798-5ea266f8880c?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=9b6b7b3b2d2a3a5b1c2f1d1d2d3c4b5e');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
}

/* ุชุบุดูุฉ ุฎูููุฉ ูุชูุถูุญ ุงููุต */
[data-testid="stAppViewContainer"]::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
    z-index: 0;
}

/* ุงูุญุงููุฉ ุงูุฃุณุงุณูุฉ */
main .block-container {
    max-width: 900px;
    margin: 2rem auto;
    position: relative;
    z-index: 1;
}

/* ุงูุนูุงููู */
h1 { font-size: 36px; color: #0b3b2f; font-weight:700; margin-bottom: 0.2rem; }
h2 { color: #0b3b2f; }

/* ุงูุจุทุงูุฉ */
.section-card {
    background: rgba(255,255,255,0.92);
    border-radius: 14px;
    padding: 18px 20px;
    box-shadow: 0 6px 20px rgba(11, 43, 31, 0.08);
    color: #012318;
}

/* ุฒุฑ ูุจูุฑ */
.big-button {
    display: inline-block;
    background: linear-gradient(90deg,#2fb67a,#1e9d63);
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    font-weight:700;
    text-decoration: none;
    margin-top: 12px;
}

/* ูุงุฆูุฉ ุงูุฎูุงุฑุงุช */
.option-btn {
    background: linear-gradient(90deg,#f0f7ef,#e6faf0);
    border-radius: 12px;
    padding: 12px;
    color: #004d32;
    margin-bottom: 10px;
}

/* ุงููุต ุฏุงุฎู Expander */
.stExpanderHeader {
    font-weight:700;
}

/* ุฃุฒุฑุงุฑ ุตุบูุฑุฉ ููุณุฎ ูุชูุฒูู */
.small-btn {
    background: #ffffff;
    border: 1px solid #e0e0e0;
    color: #083a2e;
    padding: 6px 10px;
    border-radius: 8px;
    font-weight:600;
}

/* ุชุญุณูู ูุจุฏุฆู ูุญุฌู ุงููุต */
.zikr-text { font-size: 18px; line-height: 1.8; color:#013826; }
.small-muted { color:#396b57; font-size:14px; }
</style>
"""

# ---------------------------
# ุจูุงุก ุงููุงุฌูุงุช
# ---------------------------

def show_welcome():
    st.markdown(PAGE_STYLE, unsafe_allow_html=True)
    st.write("")  # spacing
    st.markdown("<div class='section-card'>", unsafe_allow_html=True)
    st.markdown("<h1>ุจูุณููู ุงูููููู ุงูุฑููุญููููู ุงูุฑููุญูููู</h1>", unsafe_allow_html=True)
    st.markdown("<h2>ูุฑุญุจูุง ุจู ูู ุจูุช ุงูุฃุฐูุงุฑ ุงูุฅุณูุงููุฉ ๐ฟ</h2>", unsafe_allow_html=True)
    st.markdown("<p class='small-muted'>ุตููู ุนูู ุงููุจู ูุญูุฏ ๏ทบ โ <b>ุงูููู ุตููู ูุณูููู ุนูู ูุจููุง ูุญูุฏ</b> ๐บ</p>", unsafe_allow_html=True)
    st.markdown("<p class='small-muted'>ูุฐุง ุงูุชุทุจูู ูุฌูุน ุงูุฃุฐูุงุฑ ุงููุฃุซูุฑุฉ ูู ุงููุฑุขู ูุงูุณูุฉ (ูุฌููุนุงุช ุงูุฃุฐูุงุฑ ุงููุนุฑููุฉ ูุซู \"ุญุตู ุงููุณูู\" ูุบูุฑูุง) ูุน ููุงุฆุฏ ููุฌุฒุฉ.</p>", unsafe_allow_html=True)
    st.markdown("<div style='display:flex; gap:12px; align-items:center;'>", unsafe_allow_html=True)
    if st.button("๐ธ ุงูุฏุฎูู ุฅูู ุงูุตูุญุงุช ุงูุฑุฆูุณูุฉ", key="enter_btn"):
        go_home()
    st.markdown("</div>", unsafe_allow_html=True)
    st.markdown("</div>", unsafe_allow_html=True)

def show_home():
    st.markdown(PAGE_STYLE, unsafe_allow_html=True)
    st.markdown("<div class='section-card'>", unsafe_allow_html=True)
    st.markdown("<h1>ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ โ ุงูุฃุฐูุงุฑ</h1>", unsafe_allow_html=True)
    st.markdown("<p class='small-muted'>ุงุฎุชุฑ ุงููุณู ุงูุฐู ุชุฑูุฏ ุงูุงุทูุงุน ุนููู. ุฌููุน ุงููุตูุต ุจุงูุนุฑุจูุฉ ูุน ูุตุงุฏุฑ ุนุงูุฉ ูููุงุฆุฏ ูุฎุชุตุฑุฉ.</p>", unsafe_allow_html=True)

    # Search box
    search = st.text_input("๐ ุงุจุญุซ ูู ุงูุฃุฐูุงุฑ (ูููุฉ ุฃู ุฌุฒุก):", value=st.session_state.get("search", ""))
    st.session_state.search = search

    st.markdown("<hr/>", unsafe_allow_html=True)

    # List sections plus small extras
    cols = st.columns([1,1])
    with cols[0]:
        if st.button("๐ธ ูุถู ุงูุฃุฐูุงุฑ"):
            open_section("ูุถู ุงูุฃุฐูุงุฑ")
        if st.button("๐ ุฃุฐูุงุฑ ุงูุตุจุงุญ"):
            open_section("ุฃุฐูุงุฑ ุงูุตุจุงุญ")
        if st.button("๐ ุฃุฐูุงุฑ ุงููุณุงุก"):
            open_section("ุฃุฐูุงุฑ ุงููุณุงุก")
        if st.button("๐ด ุฃุฐูุงุฑ ุงูููู"):
            open_section("ุฃุฐูุงุฑ ุงูููู")
        if st.button("๐ก ุฃุฐูุงุฑ ุงูุฎุฑูุฌ ูู ุงูููุฒู"):
            open_section("ุฃุฐูุงุฑ ุงูุฎุฑูุฌ ูู ุงูููุฒู")
        if st.button("๐ ุฃุฐูุงุฑ ุงูุฏุฎูู ุฅูู ุงูููุฒู"):
            open_section("ุฃุฐูุงุฑ ุงูุฏุฎูู ุฅูู ุงูููุฒู")
    with cols[1]:
        if st.button("๐ง ุฃุฐูุงุฑ ุงููุถูุก"):
            open_section("ุฃุฐูุงุฑ ุงููุถูุก")
        if st.button("๐ฝ ุฃุฐูุงุฑ ุงูุฃูู"):
            open_section("ุฃุฐูุงุฑ ุงูุฃูู")
        if st.button("๐ ุฃุฐูุงุฑ ุจุนุฏ ุงูุตูุงุฉ"):
            open_section("ุฃุฐูุงุฑ ุจุนุฏ ุงูุตูุงุฉ")
        if st.button("๐ ุฃุฐูุงุฑ ุฏุฎูู ุงููุณุฌุฏ"):
            open_section("ุฃุฐูุงุฑ ุฏุฎูู ุงููุณุฌุฏ")
        if st.button("โ๏ธ ุฃุฐูุงุฑ ุงูุณูุฑ"):
            open_section("ุฃุฐูุงุฑ ุงูุณูุฑ")
        if st.button("๐ฅ ุฃุฐูุงุฑ ุงููุฑุจ ูุงููู"):
            open_section("ุฃุฐูุงุฑ ุงููุฑุจ ูุงููู")

    st.markdown("<hr/>", unsafe_allow_html=True)
    st.markdown("<div class='small-muted'>ููููู ุชุญููู ุฃู ูุณู ูุงูู ูููู JSON ูู ุฏุงุฎู ุตูุญุฉ ูู ูุณู.</div>", unsafe_allow_html=True)
    st.markdown("</div>", unsafe_allow_html=True)

    # quick jump to top searched results (if any)
    if search and len(search.strip()) >= 2:
        results = []
        for sec, items in ZIKR_DATA.items():
            for it in items:
                if search.strip() in it.get("text", "") or search.strip() in it.get("title", ""):
                    results.append((sec, it))
        if results:
            st.markdown("<hr/>", unsafe_allow_html=True)
            st.subheader(f"ูุชุงุฆุฌ ุงูุจุญุซ ({len(results)})")
            for sec, it in results:
                st.markdown(f"**{sec}** โ **{it['title']}**")
                st.markdown(f"<div class='zikr-text'>{it['text']}</div>", unsafe_allow_html=True)
                st.markdown(f"<div class='small-muted'>ุงููุตุฏุฑ: {it['source']} โ ุงููุงุฆุฏุฉ: {it['benefit']}</div>", unsafe_allow_html=True)
                st.markdown("---")
        else:
            st.info("ูู ุชูุนุซุฑ ุนูู ูุชุงุฆุฌ ูุทุงุจูุฉ.")

def show_section(section_name):
    st.markdown(PAGE_STYLE, unsafe_allow_html=True)
    st.markdown("<div class='section-card'>", unsafe_allow_html=True)
    st.markdown(f"<h1>๐ {section_name}</h1>", unsafe_allow_html=True)
    st.markdown(f"<p class='small-muted'>ูููุง ููู ุงูุฃุฐูุงุฑ ุงููุงุฑุฏุฉ ูู ูุณู: <b>{section_name}</b>. ุฌููุน ุงููุตูุต ูุฃุซูุฑุฉ ุนู ุงููุฑุขู ุฃู ุงูุฃุฐูุงุฑ ุงููุฃุซูุฑุฉ ูู ุงูุณูุฉ.</p>", unsafe_allow_html=True)
    st.markdown("<div style='display:flex; gap:8px; margin-bottom:12px;'>", unsafe_allow_html=True)
    if st.button("โ๏ธ ุงูุนูุฏุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ"):
        go_home()
    # ุชุญููู ุงู json
    data_bytes = download_section_json(section_name)
    st.download_button("โฌ๏ธ ุชุญููู ูุฐุง ุงููุณู (JSON)", data=data_bytes, file_name=f"{section_name}.json", mime="application/json")
    st.markdown("</div>", unsafe_allow_html=True)

    items = ZIKR_DATA.get(section_name, [])
    if not items:
        st.info("ูุง ุชูุฌุฏ ุนูุงุตุฑ ูู ูุฐุง ุงููุณู ุญุงููุงู.")
    else:
        for i, it in enumerate(items, start=1):
            with st.expander(f"{i}. {it['title']}", expanded=False):
                st.markdown(f"<div class='zikr-text'>{it['text']}</div>", unsafe_allow_html=True)
                st.markdown(f"<div class='small-muted'>ุงููุตุฏุฑ: {it['source']}</div>", unsafe_allow_html=True)
                st.markdown(f"<div class='small-muted'>ุงููุงุฆุฏุฉ: {it['benefit']}</div>", unsafe_allow_html=True)
                # ุฃุฒุฑุงุฑ ูุณุฎ ููุดุงุฑูุฉ
                cols = st.columns([1,1,1])
                with cols[0]:
                    if st.button("ูุณุฎ ุงูุฐูุฑ", key=f"copy_{section_name}_{i}"):
                        st.experimental_set_query_params()  # ูุฌุฑุฏ ุชุดุบูู ูุชูุงุฏู ุฅุนุงุฏุฉ ุงูุชูุฏูู ุงูุบูุฑ ูุฑุบูุจ
                        st.success("ุชู ูุณุฎ ุงูุฐูุฑ! ุงูุณุฎู ูู ุงูุญูู ุฃุฏูุงู ุฅู ูู ูุนูู ุงูุฒุฑ.")
                        st.text_area("ุงูุฐูุฑ (ุงูุณุฎ ููู):", value=it['text'], height=80)
                with cols[1]:
                    if st.button("ูุดุงูุฏุฉ ุงููุงุฆุฏุฉ ูุงููุตุฏุฑ", key=f"show_{section_name}_{i}"):
                        st.info(f"ุงููุตุฏุฑ: {it['source']}\n\nุงููุงุฆุฏุฉ: {it['benefit']}")
                with cols[2]:
                    # ุชูุฒูู ุฐูุฑ ูุงุญุฏ ูููู ูุตู
                    single = json.dumps({"title": it['title'], "text": it['text'], "source": it['source'], "benefit": it['benefit']}, ensure_ascii=False)
                    st.download_button("โฌ๏ธ ุชูุฒูู ุฐูุฑ", data=single.encode('utf-8'), file_name=f"{section_name}_{i}.json", mime="application/json")

    st.markdown("</div>", unsafe_allow_html=True)

# ---------------------------
# ุงูุชุทุจูู ุงูุฑุฆูุณู
# ---------------------------

def run():
    init_state()
    page = st.session_state.page

    if page == "welcome":
        show_welcome()
    elif page == "home":
        show_home()
    elif page.startswith("section::"):
        _, sec = page.split("::", 1)
        show_section(sec)
    else:
        show_home()

if __name__ == "__main__":
    run()
